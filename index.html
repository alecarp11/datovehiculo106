<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Villa Maria del Triunfo 106 - Compañía de Bomberos</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13tuaRk6wM6K1p0cQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      /* --- Colores de la paleta de bomberos --- */
      :root {
        --color-rojo-bombero: #d32f2f;
        --color-amarillo-claro: #ffeb3b;
        --color-amarillo-oscuro: #ffc107;
        --color-azul-marino: #1976d2;
        --color-gris-claro: #f4f4f4;
        --color-texto: #333;
        --color-blanco: #ffffff;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, var(--color-amarillo-claro), var(--color-amarillo-oscuro));
        color: var(--color-texto);
        line-height: 1.6;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        width: 100%;
        z-index: 1;
        position: relative;
      }

      /* --- Capa de bienvenida --- */
      .welcome-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--color-azul-marino);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
        transition: opacity 0.5s ease-in-out;
        opacity: 1;
      }
      .welcome-overlay.fade-out {
        opacity: 0;
      }
      .welcome-overlay.hidden {
        display: none;
      }
      .welcome-logo {
        width: 150px;
        height: auto;
        margin-bottom: 20px;
      }
      .welcome-text {
        color: var(--color-blanco);
        font-size: 1.8rem;
        text-align: center;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      }

      /* --- Logo principal de fondo (super grande) --- */
      .main-logo-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0.15;
        z-index: 0;
        pointer-events: none;
      }
      .main-logo-container img {
        width: 80vw;
        height: auto;
        max-width: 800px;
        max-height: 80vh;
      }

      /* --- Encabezado --- */
      header {
        text-align: center;
        padding: 30px 0;
        margin-bottom: 30px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
        width: 100%;
      }

      h1 {
        font-size: 2.8rem;
        color: var(--color-rojo-bombero);
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      h2 {
        font-size: 1.8rem;
        color: var(--color-azul-marino);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Logo pequeño al lado de Compañía de Bomberos */
      .header-logo-small {
        width: 80px;
        height: auto;
        margin-left: 25px;
        margin-right: 10px;
        vertical-align: middle;
      }
      
      /* --- Lista de Unidades --- */
      .units-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 25px;
        margin-bottom: 40px;
      }

      .unit-card {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: transform 0.3s ease, background-color 0.3s ease;
        padding: 20px;
        text-align: center;
        width: 100%;
        max-width: 280px;
        border: 3px solid var(--color-azul-marino);
      }
      .unit-card:hover {
        transform: translateY(-5px);
        background: var(--color-gris-claro);
      }
      .unit-title {
        font-size: 1.4rem;
        font-weight: bold;
        color: var(--color-rojo-bombero);
        margin-bottom: 8px;
      }
      .unit-type {
        font-size: 1rem;
        opacity: 0.9;
        color: var(--color-azul-marino);
      }
      .unit-specs {
        font-size: 0.9rem;
        color: #666;
        margin-top: 10px;
        text-align: left;
        line-height: 1.4;
      }

      /* --- Página de Unidad --- */
      .back-button-container {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .back-button, .home-button {
        background-color: var(--color-azul-marino);
        color: var(--color-amarillo-claro);
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 3px 6px rgba(25, 118, 210, 0.5);
        transition: background-color 0.3s ease, color 0.3s ease;
        user-select: none;
      }
      .back-button:hover, .home-button:hover {
        background-color: #145ea8;
        color: #fff200;
        box-shadow: 0 5px 10px rgba(20, 94, 168, 0.7);
      }

      .door {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px 20px 60px 20px;
        margin-bottom: 20px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 20px;
        transition: transform 0.3s ease;
        border: 3px solid var(--color-azul-marino);
      }
      .door:hover {
        transform: translateY(-3px);
      }
      .door-info {
        flex: 1 1 300px;
      }
      .door-title {
        font-weight: bold;
        color: var(--color-azul-marino);
        margin-bottom: 10px;
        font-size: 1.3rem;
      }
      .door-content ol {
        margin: 0;
        padding-left: 20px;
      }
      .door-content ol li {
        color: #555;
        font-size: 1rem;
        margin-bottom: 5px;
      }
      .door-content textarea {
        width: 100%;
        min-height: 100px;
        border: 1px solid var(--color-azul-marino);
        padding: 5px;
        font-size: 1rem;
        line-height: 1.6;
        resize: vertical;
      }
      .qr-code {
        flex: 0 0 140px;
        text-align: center;
        background-color: #f9f9f9;
        border-radius: 12px;
        padding: 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      .qr-code img {
        max-width: 120px;
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 5px;
        background-color: var(--color-blanco);
      }
      .qr-text {
        font-size: 0.85rem;
        margin-top: 8px;
        color: #777;
      }

      /* --- Botones de acción --- */
      .action-buttons {
        position: absolute;
        bottom: 20px;
        left: 20px;
        display: flex;
        gap: 10px;
      }
      .action-buttons button {
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, background-color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
        user-select: none;
      }
      .action-buttons button:hover {
        transform: translateY(-2px);
      }
      .edit-btn {
        background-color: var(--color-azul-marino);
        color: var(--color-amarillo-claro);
      }
      .edit-btn:hover {
        background-color: #145ea8;
      }
      .download-btn {
        background-color: #4caf50;
        color: var(--color-blanco);
      }
      .download-btn:hover {
        background-color: #45a049;
      }

      .footer {
        text-align: center;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        margin-top: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      /* --- Estilos para la vista de QR --- */
      .qr-page-container {
        padding: 2rem;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        max-width: 600px;
        text-align: left;
        margin-top: 40px;
        border: 3px solid var(--color-azul-marino);
      }
      .qr-page-container h2 {
        color: var(--color-azul-marino);
        margin-bottom: 1rem;
        font-size: 1.8rem;
        text-align: center;
      }
      .qr-page-container h3 {
        color: var(--color-rojo-bombero);
      }
      .qr-page-container ul {
        margin: 0;
        padding-left: 20px;
      }
      .qr-page-container li {
        color: #555;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }
      .qr-page-download-buttons {
          display: flex;
          gap: 15px;
          justify-content: center;
          margin-top: 20px;
      }
      .qr-page-download-buttons button {
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          transition: transform 0.2s ease;
          display: flex;
          align-items: center;
          gap: 8px;
      }
      #downloadDoorBtn {
          background-color: var(--color-azul-marino);
          color: var(--color-amarillo-claro);
      }
      #downloadDoorBtn:hover {
          background-color: #145ea8;
      }
      #downloadUnitBtn {
          background-color: var(--color-rojo-bombero);
          color: var(--color-blanco);
      }
      #downloadUnitBtn:hover {
          background-color: #b71c1c;
      }
      
      /* --- Estilos para los botones flotantes --- */
      .floating-btn-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: flex-end; /* Alinea los botones a la derecha por defecto */
      }

      .floating-download-btn, .floating-download-all-btn {
        background-color: var(--color-rojo-bombero);
        color: var(--color-blanco);
        border: none;
        padding: 15px 25px;
        border-radius: 50px;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: transform 0.3s ease, background-color 0.3s ease, opacity 0.3s ease;
        display: none; /* Inicia oculto */
        font-size: 1rem;
        white-space: nowrap;
        opacity: 1; /* Opacidad normal en PC */
      }
      
      .floating-download-btn:hover, .floating-download-all-btn:hover {
        background-color: #b71c1c;
        transform: scale(1.05);
      }

      /* --- MEDIA QUERIES PARA MÓVILES --- */
      @media (max-width: 767px) {
        .units-list {
          flex-direction: column;
        }
        h1 {
          font-size: 2.2rem;
        }
        h2 {
          font-size: 1.5rem;
          justify-content: center;
        }
        .door {
          flex-direction: column;
          align-items: flex-start;
          text-align: left;
        }
        .qr-code {
          flex: none;
          width: 100%;
          margin-top: 15px;
        }
        .main-logo-container img {
          width: 90vw;
        }
        .header-logo-small {
          width: 60px;
          margin-left: 15px;
        }
        .qr-page-download-buttons {
            flex-direction: column;
        }
        
        /* Reorganización del contenedor y los botones para vista móvil */
        .floating-btn-container {
            bottom: 20px;
            right: auto;
            left: 20px; /* Ancla el contenedor a la izquierda */
            width: calc(100% - 40px);
            flex-direction: row;
            justify-content: space-between; /* Separa los botones a los extremos */
            align-items: flex-end;
        }

        .floating-download-btn, .floating-download-all-btn {
          opacity: 0.85; /* Aplica la transparencia solo en móviles */
          padding: 12px 20px; /* Reduce un poco el tamaño para mejor ajuste */
        }
        
        #floatingDownloadAllBtn {
            margin-right: 10px; /* Añade un pequeño espacio entre botones */
        }
      }
    </style>
  </head>
  <body>
    <div class="welcome-overlay">
        <img src="https://raw.githubusercontent.com/alecarp11/datovehiculo106/12f1bb5f5bcef285e1aef26aec62044cfc877b90/Dise%C3%B1o%20sin%20t%C3%ADtulo%20(4).png" alt="Logo Compañía de Bomberos VMT 106" class="welcome-logo">
        <p class="welcome-text">¡Bienvenido a la 106!</p>
    </div>

    <div class="main-logo-container">
      <img
        src="https://raw.githubusercontent.com/alecarp11/datovehiculo106/12f1bb5f5bcef285e1aef26aec62044cfc877b90/Dise%C3%B1o%20sin%20t%C3%ADtulo%20(4).png"
        alt="Logo Compañía de Bomberos VMT 106 - Grande"
      />
    </div>

    <div class="container" id="app"></div>
    
    <div class="floating-btn-container">
        <button id="floatingDownloadAllBtn" class="floating-download-all-btn" title="Descargar todas las unidades en un solo archivo">
            Descargar Todas Unidades
        </button>
        <button id="floatingDownloadBtn" class="floating-download-btn" title="Descargar Inventario Completo">
            Descarga Unidad
        </button>
    </div>

    <script>
      const units = {
        maquina106: {
          name: "MAQUINA 106.01",
          type: "Unidad contra Incendios",
          specs: {
            placa: "EUD-266",
            cbp: "1234",
            modelo: "SPARTAN",
            ano: "2014",
            combustible: "Diésel",
          },
          doors: [
            {
              title: "Cabina",
              content: [
                "Equipos de respiración autónoma: 7 unidades",
                "Máscaras: 7 unidades",
                "Tabla rígida: 1 unidad",
                "MILWAUKE + 4 baterías: 1 unidad",
                "Caja corta anillo, Dremel: 1 unidad",
                "Sierra caladora (BOSH) 5.sierras: 1 unidad",
                "Rotomartillo (BOSH) 2 puntas: 1 unidad",
                "Maletín kit fuga de gas: 1 unidad",
              ],
            },
            {
              title: "Puerta N°1",
              content: [
                "Cadena: 1 unidad",
                "Grilletes Grandes: 2 unidad",
                "Grilletes Medianos: 2 unidad",
                "Grilletes Chicos: 2 unidad",
              ],
            },
            {
              title: "Puerta Enrollable Nº 2",
              content: [
                "Llave de embone: 2 unidades",
                "Llave de hidrante: 1 unidad",
                "Maso de goma: 1 unidad",
                "Doble hembra de 1 1/2”: 2 unidades",
                "Doble macho de 1 1/2”: 2 unidades",
                "Doble hembra 2 1/2”: 2 unidades",
                "Reductores de 2 1/2” a 1 1/2”: 2 unidades",
                "Pitones tipo pistola de 2 1/2”: 2 unidades",
                "Pitón Monitor : 1 unidad",
                "Siamesa: 1 unidad",
                "Bifurco de 2 1/2” a 1 1/2”: 1 unidad",
                "Llave estilson 24”: 1 unidad",
                "Alicate: 1 unidad",
                "Triamesa de 6 a 2 1/2”: 2 unidades",
                "Canastilla absorbente: 2 unidad",
                "Doble macho 2 1/2”: 1 unidad",
                "Cizalla 24”: 1 unidad",
              ],
            },
            {
              title: "Puerta Enrollable Nº 3",
              content: [
                "Escobas cerdas de plástico: 2 unidades",
                "Halligan: 1 unidad",
                "Pala: 1 unidad",
                "Mandarria 12”: 1 unidad",
                "Hacha de leñador: 1 unidad",
                "Hacha bomberil: 1 unidad",
                "Cizalla 14”: 4 unidades",
                "Cilindros de aire : 4 unidades",
                "Pico: 1 unidad",
                "Mantas ignifugas: 3 unidades",
                "Cuñas de metal: 2 unidad",
              ],
            },
            {
              title: "Puerta Enrollable Nº 4",
              content: [
                "Conos de seguridad: 5 unidades",
                "Prensas de contención de fuga de gas (medianas): 2 unidades",
                "Prensas de contención de fuga de gas (pequeñas): 3 unidades",
                "Linterna trípode (Dewalt): 1 unidad",
                "Gata lagarto 5 toneladas: 1 unidad",
                "Rollo de cinta de seguridad: 1 unidad",
                "Kit gas natural: 1 unidad",
                "Pala de bronce: 1 unidad",
                "Extintor de agua: 1 unidad",
              ],
            },
            {
              title: "Puerta N°5",
              content: ["Llave T Grande: 1 unidad", "Bichero de Madera: 1 unidad"],
            },
            {
              title: "Puerta Enrollable N°6",
              content: [
                "Maleta cuerdas 29 mts: 1 unidad",
                "Maleta cuerdas 28 mts: 1 unidad",
                "Maleta cuerdas 54 mts: 1 unidad",
                "Tacos escalonados: 2 unidades",
                "Arnes integral azul: 1 unidad",
                "Pulpo para cantilla: 1 unidad",
                "Gibbs: 3 unidades",
                "Plato de distribución: 2 unidades",
                "3 con orejones: 7 unidades",
                "Mosquetones de aluminio: 12 unidades",
                "Mosquetones de acero: 2 unidades",
                "Polea simples rojos: 4 unidades",
                "Polea doble rojos: 2 unidades",
                "Polea simple azul: 1 unidad",
                "Polea doble pequeña, porada: 1 unidad",
                "Cordinos verdes: 5 unidades",
                "Cintas planas cocidas. rojas: 6 unidades",
                "Cintas planas cocidas. verdes: 3 unidades",
                "Cinta plana cocida. negra: 1 unidad",
                "Cordinos pegados, verde, punta amarilla: 3 unidades",
                "Cinta de seguridad Sked: 3 unidades",
                "Calendario: 1 unidad",
                "Arnés de piernas: 1 unidad",
                "Tacos 4x8”: 4 unidades",
                "Tacos 4x16”: 4 unidades",
                "Tacos 2x8”: 3 unidades",
                "Tacos cuñas: 3 unidades",
                "C3x 23x3: 3 unidades",
                "23x 29x5: 2 unidades",
                "23x PxT: 4 unidades",
                "Eslingas de 2 mts: 2 unidades",
                "Eslingas de 3 mts: 2 unidades",
                "Eslingas: 8 unidades",
              ],
            },
            {
              title: "Puerta N°7",
              content: [
                "Bichero : 1 Unidad",
                "Escalera 2 cuerpos- 24 pasos: 1 Unidad",
                "Escalera 1 cuerpo con ganchos: 12 pasos: 1Unidad",
                "Llave T: 1 Unidad",
              ],
            },
            {
              title: "Puerta Enrollable N°8",
              content: [
                "Grupo electrógeno marca honda 500: 1 unidad",
                "Motosierra de 17”: 1 unidad",
                "Mototrasadora: 1 unidad",
                "Amoladora: 1 unidad",
              ],
            },
            {
              title: "Puerta Enrollable Nº 9",
              content: [
                "Lágrimas acrílicas de rescate vehicular: 3 unidades",
                "Estabilizadores laterales de rescate: 2 unidades",
                "Estabilizadores HILFIT: 2 unidades",
                "Cizalla HOLMATRO: 1 unidad",
                "SKED: 1 unidad",
              ],
            },
            {
              title: "Puerta Enrollable Nº 10",
              content: [
                "Bolsa de ferula azul: 1 unidad",
                "Expanzor: 1 unidad",
                "Cizalla pico de loro: 1 unidad",
                "Expansor Cilindrico: 1 unidad",
                "Soporte RAM: 1 unidad",
                "Seguro Airbag: 1 unidad",
                "Baterias: 3 Unidades",
              ],
            },
            {
              title: "Puerta N°11",
              content: ["Paño de Abastecimiento 2 1/2: 1 unidad"],
            },
            {
              title: "Cama (techo)",
              content: [
                "Pitones de 1 1/2\" exterior 1 1/2”: 4 unidades",
                "Bifurco de 2 1/2” a 1 1/2”: 1 unidad",
                "Canastilla de rescate anaranjada: 1 unidad",
                "Rígidas 2 1/2: 2 unidades",
              ],
            },
          ],
        },
        cisterna106: {
          name: "CISTERNA 106",
          type: "Unidad de abastecimiento de agua",
          specs: {
            placa: "",
            cbp: "0520",
            modelo: "Hino TC",
            ano: "1982",
            combustible: "Diésel",
          },
          doors: [
            {
              title: "Puerta Principal (General)",
              content: [],
            },
          ],
        },
        rescateLigera106: {
          name: "RESCATE LIGERA 106",
          type: "Unidad de respuesta rápida",
          specs: {
            placa: "EGB-658",
            cbp: "1991",
            modelo: "Toyota Hilux",
            ano: "2010",
            combustible: "Gasolina",
          },
          doors: [
            {
              title: "Puerta Principal - (General)",
              content: [],
            },
          ],
        },
        rescate106: {
          name: "RESCATE 106",
          type: "Unidad de rescate pesado",
          specs: {
            placa: "",
            cbp: "1222",
            modelo: "HAHN",
            ano: "1980",
            combustible: "Diésel",
          },
          doors: [
            { title: "Puerta 1", content: [] },
            { title: "Puerta 2", content: [] },
            { title: "Puerta 3", content: [] },
            { title: "Puerta 4", content: [] },
            { title: "Puerta 5", content: [] },
            { title: "Puerta 6", content: [] },
            { title: "Puerta 7", content: [] },
            { title: "Puerta 8", content: [] },
            { title: "Puerta 9", content: [] },
            { title: "Puerta 10", content: [] },
          ],
        },
        ambulancia106: {
          name: "AMBULANCIA 106",
          type: "Unidad de atención médica",
          specs: {
            placa: "EUE-103",
            cbp: "",
            modelo: "Peugeot",
            ano: "",
            combustible: "",
          },
          doors: [
            {
              title: "Puerta Principal - Equipamiento Médico",
              content: [],
            },
          ],
        },
      };

      const app = document.getElementById("app");
      const passwords = {
        maquina106: "M@q-106!",
        cisterna106: "Cis*ter-n@",
        rescateLigera106: "R3sc@t3-Lg",
        rescate106: "R3sc@t3-106",
        ambulancia106: "4mb-Ul@nci@",
      };
      
      const floatingDownloadBtn = document.getElementById('floatingDownloadBtn');
      const floatingDownloadAllBtn = document.getElementById('floatingDownloadAllBtn');
      const welcomeOverlay = document.querySelector('.welcome-overlay');

      function saveData() {
        localStorage.setItem("unitsData", JSON.stringify(units));
      }

      function loadData() {
        const storedData = localStorage.getItem("unitsData");
        if (storedData) {
          Object.assign(units, JSON.parse(storedData));
        }
      }

      function generateQR(unitId, doorIndex) {
        const baseUrl = window.location.href.split("#")[0];
        const qrContent = `${baseUrl}#door=${unitId}-${doorIndex}`;
        return `https://quickchart.io/qr?text=${encodeURIComponent(
          qrContent
        )}&size=120`;
      }

      function showFloatingButtons(allUnitsPage = false) {
        if (allUnitsPage) {
          floatingDownloadAllBtn.style.display = 'block';
          floatingDownloadBtn.style.display = 'none';
        } else {
          floatingDownloadBtn.style.display = 'block';
          floatingDownloadAllBtn.style.display = 'none';
        }
      }
      
      function hideFloatingButtons() {
        floatingDownloadBtn.style.display = 'none';
        floatingDownloadAllBtn.style.display = 'none';
      }

      function showWelcomeMessage(duration = 1500) {
          welcomeOverlay.classList.remove('hidden', 'fade-out');
          setTimeout(() => {
              welcomeOverlay.classList.add('fade-out');
              setTimeout(() => {
                  welcomeOverlay.classList.add('hidden');
              }, 500);
          }, duration);
      }
      
      function renderUnitsList() {
        document.title = "Villa Maria del Triunfo 106 - Compañía de Bomberos";
        showFloatingButtons(true);
        app.innerHTML = `
            <header>
              <h1>Villa Maria del Triunfo 106</h1>
              <h2>Compañía de Bomberos <img src="https://raw.githubusercontent.com/alecarp11/datovehiculo106/12f1bb5f5bcef285e1aef26aec62044cfc877b90/Dise%C3%B1o%20sin%20t%C3%ADtulo%20(4).png" alt="Logo Compañía de Bomberos VMT 106 - Pequeño" class="header-logo-small"></h2>
              <p>Sistema de gestión de unidades y equipamiento</p>
            </header>
            <div class="units-list">
              ${Object.entries(units)
                .map(
                  ([id, unit]) => `
                <div class="unit-card" data-id="${id}">
                  <div class="unit-title">${unit.name}</div>
                  <div class="unit-type">${unit.type}</div>
                  <div class="unit-specs">
                    <strong>Placa:</strong> ${unit.specs.placa}<br>
                    <strong>CBP:</strong> ${unit.specs.cbp}<br>
                    <strong>Modelo:</strong> ${unit.specs.modelo}<br>
                    <strong>Año:</strong> ${unit.specs.ano}<br>
                    <strong>Combustible:</strong> ${unit.specs.combustible}
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
            <div class="footer">
              <p>Villa Maria del Triunfo 106 - Compañía de Bomberos Voluntarios</p>
              <p>Sistema de Gestión de Equipos © 2023</p>
            </div>
          `;

        document.querySelectorAll(".unit-card").forEach((card) => {
          card.addEventListener("click", () => {
            const unitId = card.getAttribute("data-id");
            renderUnitPage(unitId);
            history.pushState({ unitId }, "", `#unit=${unitId}`);
          });
        });
      }

      function renderUnitPage(unitId) {
        const unit = units[unitId];
        if (!unit) {
          renderUnitsList();
          return;
        }
        document.title = `${unit.name} - Villa Maria del Triunfo 106`;

        app.innerHTML = `
          <button class="back-button" id="backBtn"><i class="fas fa-arrow-left"></i> Volver</button>
          <header>
            <h1>${unit.name}</h1>
            <h2>${unit.type} <img src="https://raw.githubusercontent.com/alecarp11/datovehiculo106/12f1bb5f5bcef285e1aef26aec62044cfc877b90/Dise%C3%B1o%20sin%20t%C3%ADtulo%20(4).png" alt="Logo Compañía de Bomberos VMT 106 - Pequeño" class="header-logo-small"></h2>
            <div class="unit-specs" style="text-align:center;">
              <strong>Placa:</strong> ${unit.specs.placa} |
              <strong>CBP:</strong> ${unit.specs.cbp} |
              <strong>Modelo:</strong> ${unit.specs.modelo} |
              <strong>Año:</strong> ${unit.specs.ano} |
              <strong>Combustible:</strong> ${unit.specs.combustible}
            </div>
          </header>
          <div class="doors-list">
            ${unit.doors
              .map(
                (door, index) => `
              <div class="door" data-door-index="${index}" data-unit-id="${unitId}">
                <div class="door-info">
                  <div class="door-title">${door.title}</div>
                  <div class="door-content">
                    <ol>
                      ${door.content.map((item) => `<li>${item}</li>`).join("")}
                    </ol>
                  </div>
                </div>
                <div class="qr-code">
                  <img src="${generateQR(
                    unitId,
                    index
                  )}" alt="Código QR ${door.title}" />
                  <div class="qr-text">Escanea para ver detalles del equipo</div>
                </div>
                <div class="action-buttons">
                  <button class="edit-btn" title="Editar contenido de la puerta" data-unit-id="${unitId}">
                    <i class="fas fa-edit"></i> Editar
                  </button>
                  <button class="download-btn" title="Descargar datos de la puerta">
                    <i class="fas fa-file-excel"></i> Excel
                  </button>
                </div>
              </div>
            `
              )
              .join("")}
          </div>
          <div class="footer">
            <p>Villa Maria del Triunfo 106 - Compañía de Bomberos Voluntarios</p>
            <p>Sistema de Gestión de Equipos © 2023</p>
          </div>
        `;

        document.getElementById("backBtn").addEventListener("click", () => {
          history.back();
        });

        document.querySelectorAll(".edit-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const doorDiv = btn.closest(".door");
            const doorContentDiv = doorDiv.querySelector(".door-content");
            const doorIndex = parseInt(doorDiv.getAttribute("data-door-index"));
            const unitIdForPassword = btn.getAttribute("data-unit-id");
            const correctPassword = passwords[unitIdForPassword];

            if (btn.textContent.includes("Guardar")) {
              const newContent = doorContentDiv
                .querySelector("textarea")
                .value.split("\n")
                .filter(Boolean)
                .map((item) => item.trim());
              units[unitId].doors[doorIndex].content = newContent;
              saveData();
              renderUnitPage(unitId);
            } else {
              const password = prompt(
                "Por favor, ingrese la contraseña para editar:"
              );
              if (password === correctPassword) {
                const currentContentText =
                  units[unitId].doors[doorIndex].content.join("\n");
                doorContentDiv.innerHTML = `<textarea>${currentContentText}</textarea>`;
                btn.innerHTML = '<i class="fas fa-save"></i> Guardar';
                doorContentDiv.querySelector("textarea").focus();
              } else if (password !== null) {
                alert("Contraseña incorrecta. No se puede editar.");
              }
            }
          });
        });

        document.querySelectorAll(".download-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const doorDiv = btn.closest(".door");
            const unitId = doorDiv.getAttribute("data-unit-id");
            const doorIndex = parseInt(doorDiv.getAttribute("data-door-index"));
            const unit = units[unitId];
            const door = unit.doors[doorIndex];
            downloadExcel(unit, door);
          });
        });
        showFloatingButtons();
      }

      function renderDoorPage(unitId, doorIndex) {
        const unit = units[unitId];
        const door = unit.doors[doorIndex];
        if (!unit || !door) {
          renderUnitsList();
          return;
        }

        document.title = `${door.title} - ${unit.name}`;
        showFloatingButtons();

        app.innerHTML = `
          <div class="back-button-container">
            <button class="back-button" id="backBtn"><i class="fas fa-arrow-left"></i> Regresar</button>
            <button class="home-button" id="homeBtn"><i class="fas fa-home"></i> Inicio</button>
          </div>
          <div class="qr-page-container">
            <h2>${door.title}</h2>
            <p><strong>Unidad:</strong> ${unit.name}</p>
            <h3>Equipamiento:</h3>
            <ul>
              ${door.content.map((item) => `<li>${item}</li>`).join("")}
            </ul>
            <div class="qr-page-download-buttons">
                <button id="downloadDoorBtn">
                    <i class="fas fa-file-excel"></i> Descargar Puerta
                </button>
            </div>
          </div>
        `;

        document.getElementById("backBtn").addEventListener("click", () => {
          history.back();
        });
        
        document.getElementById("homeBtn").addEventListener("click", () => {
          renderUnitsList();
          history.pushState({}, "", `#`);
        });

        document.getElementById("downloadDoorBtn").addEventListener("click", () => {
            downloadExcel(unit, door);
        });
      }

      function downloadExcel(unit, door) {
        const data = [
          ["Unidad", unit.name],
          ["Puerta", door.title],
          [],
          ["Contenido"],
        ];

        door.content.forEach((item) => {
          data.push([item]);
        });

        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Equipamiento");

        const filename = `${unit.name.replace(/\s/g, "_")}_${door.title.replace(/\s/g, "_")}.xlsx`;
        XLSX.writeFile(wb, filename);
      }
      
      function downloadAllData(unitId) {
        const currentUnit = units[unitId];
        if (!currentUnit) {
            alert("No se encontró la unidad para descargar.");
            return;
        }

        const wb = XLSX.utils.book_new();
        const unitData = [
            ["Unidad", currentUnit.name],
            ["Tipo", currentUnit.type],
            ["Placa", currentUnit.specs.placa],
            ["CBP", currentUnit.specs.cbp],
            ["Modelo", currentUnit.specs.modelo],
            ["Año", currentUnit.specs.ano],
            ["Combustible", currentUnit.specs.combustible],
            [],
        ];

        currentUnit.doors.forEach((door) => {
            unitData.push(
                [`Puerta: ${door.title}`],
                ["Contenido"],
                ...door.content.map((item) => [item]),
                []
            );
        });

        const ws = XLSX.utils.aoa_to_sheet(unitData);
        XLSX.utils.book_append_sheet(wb, ws, currentUnit.name.substring(0, 31));

        const filename = `${currentUnit.name.replace(/\s/g, "_")}.xlsx`;
        XLSX.writeFile(wb, filename);
      }
      
      function downloadAllUnitsData() {
        const wb = XLSX.utils.book_new();

        Object.keys(units).forEach(unitId => {
            const currentUnit = units[unitId];
            const unitData = [
                ["Unidad", currentUnit.name],
                ["Tipo", currentUnit.type],
                ["Placa", currentUnit.specs.placa],
                ["CBP", currentUnit.specs.cbp],
                ["Modelo", currentUnit.specs.modelo],
                ["Año", currentUnit.specs.ano],
                ["Combustible", currentUnit.specs.combustible],
                [],
            ];

            currentUnit.doors.forEach((door) => {
                unitData.push(
                    [`Puerta: ${door.title}`],
                    ["Contenido"],
                    ...door.content.map((item) => [item]),
                    []
                );
            });

            const ws = XLSX.utils.aoa_to_sheet(unitData);
            const sheetName = currentUnit.name.replace(/\s/g, "_").substring(0, 31);
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
        });

        XLSX.writeFile(wb, "Inventario_Completo_Unidades_106.xlsx");
      }

      function handleUrlFragment() {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const doorParam = params.get("door");
        const unitParam = params.get("unit");

        if (doorParam) {
          showWelcomeMessage(1500); // Muestra la bienvenida por 1.5s
          const [unitId, doorIndex] = doorParam.split("-");
          if (unitId && doorIndex) {
            renderDoorPage(unitId, parseInt(doorIndex));
          } else {
            renderUnitsList();
          }
        } else if (unitParam) {
          renderUnitPage(unitParam);
        } else {
          renderUnitsList();
        }
      }

      window.addEventListener("hashchange", handleUrlFragment);

      floatingDownloadBtn.addEventListener("click", () => {
          const hash = window.location.hash.substring(1);
          const params = new URLSearchParams(hash);
          const unitId = params.get("unit");
          const doorId = params.get("door");

          if (unitId) {
            downloadAllData(unitId);
          } else if (doorId) {
            const [unitIdFromDoor] = doorId.split("-");
            downloadAllData(unitIdFromDoor);
          } else {
              alert("Por favor, navega a una unidad o puerta para descargar su inventario completo.");
          }
      });
      
      floatingDownloadAllBtn.addEventListener("click", () => {
          downloadAllUnitsData();
      });

      function init() {
        if (window.location.hash === '') {
            showWelcomeMessage(2500); // Muestra la bienvenida inicial por 2.5s
        }

        loadData();
        handleUrlFragment();
      }

      init();
    </script>
  </body>
</html>
